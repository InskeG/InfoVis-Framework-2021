{% extends "base.html" %}
{% block title %}Metrics{% endblock %}
{% block css %}<link href="../static/css/heatmap.css" rel="stylesheet">{% endblock %}
{% block nav %}

	<nav class="navbar navbar-default justify-content-center flex-md-nowrap navbar-expand-md" id = "navbar-top">
		<div class="navbar-collapse" id="navbarCollapse">
			<ul class="navbar-nav">
				<li class="nav-item">
					<a class="nav-link" id="nav-link-home" href="/">Home</a>
				</li>
				<li class="nav-item active">
					<a class="nav-link"  id="nav-link-metrics" href="/metrics">Music Metrics</a>
				</li>
				<li class="nav-item">
					<a class="nav-link"  id="nav-link-popularity" href="/popularity">Music Popularity</a>
				</li>
			</ul>
		</div>
	</nav>

<link rel="stylesheet" type="text/css" href="../static/css/base.css">
{% endblock %}

{% block body %}


<!-- Begin page content -->
<h2 class="mt-3">Metrics plot</h2>

<div id = "wrapper-full">
	<div id = "wrapper-viz">
		<div id = "viz-title">
			<h1>Spotify artists and musical characteristics: a visualization</h1>
		</div>
		<div id = "viz-subtitle-heatmap" class = "viz-subtitle">
			<h2>Average value of musical characteristics</h2>
		</div>
		<div id = "viz-subtitle-artist" class = "viz-subtitle-center">
			<h2>Artist</h2>
			<h2>Current popularity</h2>
		</div>
		<div id = "viz-subtitle-barchart" class = "viz-subtitle">
			<h2>Musical characteristics of most popular songs</h2>
		</div>
		<div id="heatmap">

		</div>
		<div id="legend">

		</div>
		<div id="barchart">

		</div>
	</div>
	<div id = "wrapper-filters">
		<form class="artistForm" autocomplete="off" onSubmit="return addArtist(this)">
			<div class="autocomplete">
				<input id="artistInput" class="artistText" placeholder="Select an artist" type="text" name="artist" value="">
			</div>
			<ul class="artist-list">
				{% for artist in artists: %}
				<li class="artist-list-element" id="list{{ artist.replace(' ', '') }}">
					{{ artist }}
					<button class="artist-list-button" type="button" name="delete{{ artist.replace(' ', '') }}" onClick="removeArtist('{{ artist }}')">x</button>
				</li>{% endfor %}
			</ul>
			<input class="resetButton" type="button" name="button" value="Reset" onClick="window.location.reload(true)">
			<input class="showButton" type="submit" name="submit" value="Show >" >
		</form>
	</div>
</div>

<!-- End page content-->
<script type="text/javascript" src="../static/js/songbarchart.js"></script>
<script type="text/javascript" src="../static/js/heatmap.js"></script>
<script type="text/javascript" src="../static/js/autocomplete.js"></script>
<script type="text/javascript">
	var heatmap_data = {{ heatmap_data | safe }};
	var colors = {{ heatmap_colors | safe }};
	var barchart_data = {{ song_data | safe }};
	var popularity = {{ popularity | safe }};
	var y_variables = {{ artists | safe }};
	var all_artists = {{ all_artists | safe }}
	var manual_artists = false;
	var y_to_i = {};
	var i = 0;
	for (var key in y_variables) {
		y_to_i[y_variables[key]] = i++;
	}
	var x_variables = {{ keys | safe }};

	var padding = {top: 10, right: 50, bottom: 5, left: 10},
	  	fullwidth = (1800 * 0.87)  - padding.left - padding.right,
	  	fullheight = (800 * 0.85) - padding.top - padding.bottom,
	  	width_heatmap = fullwidth * 0.45,
	  	width_artists = fullwidth * 0.1,
	  	width_barchart = fullwidth * 0.45,
		width_transform = width_heatmap + 78;

	var mini_chart_height = (fullheight - 40) / y_variables.length ,
		mini_chart_width = width_barchart / x_variables.length;

	var x_1 = d3.scaleBand().rangeRound([0, width_barchart]),
        x_2 = d3.scaleBand().rangeRound([0, mini_chart_width]),
        y_2 = d3.scaleLinear().rangeRound([mini_chart_height-7, 7]);

    x_1.domain(x_variables);
    x_2.domain([0, 1, 2, 3, 4, 5, 6, 7, 8, 9]);
    y_2.domain([-100, 100]);

	var y = d3.scaleBand()
		.range([padding.top+5, fullheight - 20])
		.domain(y_variables)
		.padding(0.05);

	var tooltip = d3.select("#heatmap")
        .append("div")
        .style("opacity", 0)
        .attr("class", "tooltip");

	var svgHeatMap = d3.select("#heatmap").append("svg")
			    .attr("height", fullheight)
				.attr("width", width_heatmap + width_artists + padding.left);

	var svgBarCharts = d3.select("#heatmap").append("svg")
	.attr("height", fullheight)
	.attr("width", width_barchart + padding.right);

	var svgLegendHeatMap = d3.select("#heatmap") // HTML tag
    .append("svg")
    .attr("width", width_heatmap+5)
    .attr("height", 40);

	var svgLegendPop = d3.select("#heatmap")
	.append("svg")
	.attr("width", width_artists)
	.attr("height", 40);

	createHeatMapPlot();
	createBarChartPlot();
	autocomplete(document.getElementById("artistInput"), all_artists);
</script>


{% endblock %}
