{% extends "base.html" %}
{% block title %}Metrics{% endblock %}
{% block css %}<link href="../static/css/heatmap.css" rel="stylesheet">{% endblock %}
{% block nav %}

	<nav class="navbar navbar-default justify-content-center flex-md-nowrap navbar-expand-md" id = "navbar-top">
		<div class="navbar-collapse" id="navbarCollapse">
			<ul class="navbar-nav">
				<li class="nav-item">
					<a class="nav-link" id="nav-link-home" href="/">Home</a>
				</li>
				<li class="nav-item active">
					<a class="nav-link"  id="nav-link-metrics" href="/metrics">Music Metrics</a>
				</li>
				<li class="nav-item">
					<a class="nav-link"  id="nav-link-popularity" href="/popularity">Music Popularity</a>
				</li>
			</ul>
		</div>
	</nav>

<link rel="stylesheet" type="text/css" href="../static/css/base.css">
{% endblock %}

{% block body %}


<!-- Begin page content -->
    <h2 class="mt-3">Metrics plot</h2>
	<form class="" onSubmit="return addArtist(this)">
		<input type="text" name="artist" value="">
		<input type="submit" name="submit" value="Add an Artist">
	</form>
	<div class = "content_2">
		<div class = "content_2_plot" id="barchart">

<div id = "wrapper-full">
	<div id = "wrapper-viz">
		<div id = "viz-title">
			<h1>Spotify artists and musical characteristics: a visualization</h1>
		</div>
		<div id = "viz-subtitle-heatmap" class = "viz-subtitle">
			<h2>Average value of musical characteristics</h2>
		</div>
		<div id = "viz-subtitle-artist" class = "viz-subtitle-center">
			<h2>Artist</h2>
			<h2>Current popularity</h2>
		</div>
		<div id = "viz-subtitle-barchart" class = "viz-subtitle">
			<h2>Musical characteristics of most popular songs</h2>
		</div>
		<div id="heatmap">

		</div>
		<div id="legend">

		</div>
	</div>
	<div id = "wrapper-filters">

		</div>
	</div>

<!-- End page content-->
<script type="text/javascript" src="../static/js/songbarchart.js"></script>
<script type="text/javascript" src="../static/js/heatmap.js"></script>
<script type="text/javascript">
	var song_data = {{ song_data | safe }};
	var y_variables = {{ artists | safe }};
	var manual_artists = false;
	var y_to_i = {};
	var i = 0;
	for (var key in y_variables) {
		y_to_i[y_variables[key]] = i++;
	}
	var x_variables = {{ keys | safe }};

	var width = 1300;
	var height = 1300;
	var chart_height = 1100,
		chart_width = 900,
		mini_chart_height = chart_height / y_variables.length,
		mini_chart_width = chart_width / x_variables.length;

	var svgContainer = d3.select("#barchart").append("svg")
					.attr("height", height)
					.attr("width", width);

	var x_1 = d3.scaleBand().rangeRound([0, chart_width]),
	    x_2 = d3.scaleBand().rangeRound([0, mini_chart_width]),
		y_1 = d3.scaleBand().rangeRound([0, chart_height]),
	    y_2 = d3.scaleLinear().rangeRound([mini_chart_height-7, 7]);

	x_1.domain(x_variables);
	x_2.domain([0, 1, 2, 3, 4, 5, 6, 7, 8, 9]);
	y_1.domain(y_variables);
	y_2.domain([-100, 100]);
	var data = {{ heatmap_data | safe }};
	var colors = {{ heatmap_colors | safe }};

	var padding = {top: 10, right: 10, bottom: 5, left: 10},
	  fullwidth = (1500 * 0.87)  - padding.left - padding.right,
	  fullheight = (800 * 0.85) - padding.top - padding.bottom,
	  width_heatmap = fullwidth * 0.5,
	  width_artists = fullwidth * 0.1,
	  width_barchart = fullwidth * 0.4

	var svg = d3.select("#heatmap").append("svg")
					  .attr("height", fullheight)
					  .attr("width", width_heatmap + width_artists + padding.left)
					.append("g")


	createPlot();
</script>


{% endblock %}
